@using Cats.Services.Security
@using LanguageHelpers.Localization
@{
    var user = (UserIdentity)HttpContext.Current.User.Identity;
    
    }
<style>
    .map
    {
       position:absolute;
        top:10px;
        left:10px;
        width:700px;
        bottom:10px;
        
       
    }
    .map-container
    {
         position:absolute;
        top:100px;
        left:10px;
        bottom:20px;
        right:50px;
        
        border:solid 1px #DDD;
    }
    .map-legend
    {
       position:absolute;
        top:10px;
        left:720px;
        right:5px;
        bottom:10px;
        
       
    }
        .map-legend .title
        {
            font-size:20px;
            line-height:40px;
        }
        .map-legend .item
        {
            line-height:40px;
            border-bottom:solid 1px #EEE;
        }
        .map-legend .pallet
        {
            line-height:40px;
            padding:4px;
            padding-left:10px;
            padding-right:10px;
            border-radius:6px;
        }


</style>
<link rel="stylesheet" href="~/Content/MapResources/openlayers/theme/default/style.css" type="text/css">
<script src="~/Content/MapResources/OpenlayersWrapper.js"></script>
<script src="~/Content/MapResources/openlayers/lib/OpenLayers.js"></script>
<script src="~/Content/MapResources/MapStyle.js"></script>
<script src="~/Content/MapResources/MapLegend.js"></script>

<div class="map-container">
<div id="map1" class="map"></div>
<div id="divLegend" class="map-legend">Legend</div>


</div>
<div id="map2" class="map2">
</div>
<div style="height:600px;"></div>
<script>
        
    function mapController($http, $scope, $timeout) {
        $scope.countryShapeURL = "/Content/MapResources/MapData/ethiopiaJson.js";
        $scope.regionShapeURL = "/Content/MapResources/MapData/ethiopiaRegions.js";
        $scope.getData = function () {

        }
    }
    var countryShapeURL = "/Content/MapResources/MapData/ethiopiaJson.js";
    var regionShapeURL = "/Content/MapResources/MapData/ethiopiaRegions.txt";
    $(function () {
        var shadingOption = { h: 226, s: 59, b1: 220, b2: 150, sample: 5, noValColor: "rgb(240,240,240)" };
        ShowLegend();
        var hrdSummary = {};
        var HRDUrl= "@Url.Action("HRDDetail_Read", "HRD", new { Area = "EarlyWarning" })";

        function aggregateRegionBeneficiaries(data) {
            var regionBen = {};
            for (var i in data) {
                var regionID = data[i].RegionID;

                if (!regionBen["row" + regionID]) {
                    regionBen["row" + regionID] = { RegionID: regionID, RegionName: data[i].Region, NumberOfBeneficiaries: 0 };
                }
                regionBen["row" + regionID].NumberOfBeneficiaries += data[i].NumberOfBeneficiaries / 1;
                
            }
            return regionBen;
        }
        $.post(HRDUrl, {}, function (data) {
            drawRegionBenficiaryMap(data.Data);
        });

        function drawRegionBenficiaryMap(data) {
            var regionBen = aggregateRegionBeneficiaries(data);

            var dataTable = regionBen;
            var key = "RegionID";
            var indicator = "NumberOfBeneficiaries";
            
            console.log("drawRegionBenficiaryMap", regionBen);
           /* var shadingOption = {h:226,s:59, b1:220, b2:150, sample:5, noValColor: "rgb(240,240,240)" };
            
            var mapLayer =
                [
                    { name: "Ethiopia", url: countryShapeURL, styleMap: stylePresets.outline }
                   ,{ name: "Regions", url: regionShapeURL, style: getPolygonShadingStyle(key, dataTable, indicator, shadingOption) }
                ];
            */
            var shadingOption2 = {};
            var mapLayer =
                [
                    { name: "Regions", url: regionShapeURL, style: getPolygonShadingStyle(key, dataTable, indicator, shadingOption2) }
                ];
            CreateMap("map1", { layers: mapLayer });
            
        }


    });
    
</script>
