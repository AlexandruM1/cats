@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
    const string PAGE_NAME = "Logistics.Index";
}

@section styles
{
    <link href="~/Content/Dashboard/dashboardcomponents.css" rel="stylesheet" />
}
<div ng-app="myApp">

    <div class="container">

        <div>
            <div class="row" style="border-bottom-width: thin; border-bottom-color: #666; border-bottom-style: inset; margin-top: 5px">

                <div class="pull-left">
                    <h4>Finance Dashboard</h4>
                </div>
                <div class="pull-right">
                    <div class="btn-group">
                        <button id="paymentRequestHeader" type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-arrow-up"></i>
                            <i class="icon-arrow-down"></i>
                        </button>

                    </div>
                </div>
            </div>
            <div id="paymentRequestContent" class="row">
                <div>&nbsp;</div>
                <div ng-controller="paymentRequestController" class="span11">
                    <div class="portlet">
                        <div class="portlet-header">
                            <h3>
                                <i class=""></i>Payment Status
                            </h3>
                        </div>

                        <!-- /.portlet-header -->

                        <div class="portlet-content">
                            <th class="table-responsive">
                            <table id="" class="table table-striped table-checkable">
                                <thead>
                                    @*<th class="portlet-header" colspan="7">Payment Request</th>*@
                                    @*<th class="portlet-header" colspan="3">Reference</th>*@
                                    <tr>
                                            
                                        <th class="hidden-xs">Number</th>
                                        <th>Transporter Name</th>
                                       @* <th style="text-align: center">Commodity</th>
                                        <th style="text-align: center">Source</th>*@
                                        @*<th style="text-align: center">Destination</th>*@
                                        <th style="text-align: right">Received Quantity</th>
                                        <th style="text-align: right">Shortage Quantity</th>
                                        <th style="text-align: right">Shortage Birr</th>
                                        <th style="text-align: right">Freight Charge</th>
                                        <th></th>
                                        @*<th>Date</th>
                                        <th>Check No</th>
                                        <th>PV No</th>*@
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="req in paymentRequestForDashboard">
                                        <td class="hidden-xs" style="text-align: center; ">{{$index + 1}}</td>
                                        <td>@* <a ng-href="@Url.Content("~/Finance/ValidatedPaymentRequest/PaymentRequests/{{req.TransporterId}}")">*@ {{req.TransporterName}}</td>
                                       @*@* <td style="text-align: center; margin-right: 20px">{{req.CommodityName}}</td>
                                        <td style="text-align: center; margin-right: 20px">{{req.SourceName}}</td>*@
                                        @*<td style="text-align: right; margin-right: 20px">{{req.DestinationName}}</td>*@
                                        <td style="text-align: right; margin-right: 0px">{{req.ReceivedQuantity | number:2}} </td>
                                        <td style="text-align: right; margin-right: 0px">{{req.ShortageQuantity | number:2}}</td>
                                        <td style="text-align: right; margin-right: 0px">{{req.ShortageBirr | number:2}} </td>
                                        <td style="text-align: right; margin-right: 0px">{{req.FreightCharge}}</td>
                                        @*<th>{{req.ChequeNo}}</th>
                                        <th>{{req.PVNo}}</th>*@
                                         <td>
                                                    <a ng-click="viewPaymentDetail(req)" class="btn btn-sm btn-default">View <i class="icon-chevron-right"></i></a>
                                           </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>


    <div class="container">

        <div>
            <div class="row" style="border-bottom-width: thin; border-bottom-color: #666; border-bottom-style: inset; margin-top: 5px">

                <div class="pull-left">
                    <h4>Cheque</h4>
                </div>
                <div class="pull-right">
                    <div class="btn-group">
                        <button id="ChequeHeader" type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-arrow-up"></i>
                            <i class="icon-arrow-down"></i>
                        </button>

                    </div>
                </div>
            </div>
            <div id="ChequeContent" class="row">
                <div>&nbsp;</div>
                <div ng-controller="ChequeController" class="span11">
                    <div class="portlet">
                        <div class="portlet-header">
                            <h3>

                                <i class=""></i>
                                Cheque Status
                            </h3>
                            <ul class="portlet-tools pull-right">
                                <li>
                                    <a href="@Url.Action("Index","Cheque",new {Area ="Finance"})">Detail</a>   

                                </li>
                            </ul>
                        </div>

                        <!-- /.portlet-header -->

                        <div class="portlet-content">
                            <th class="table-responsive">
                            <table id="" class="table table-striped table-checkable">
                                <thead>
                                    <tr>
                                        <th class="hidden-xs">Number</th>
                                        <th>Cheque No</th>
                                        <th>Transporter</th>
                                        <th>Amount</th>
                                        <th>Bank</th>
                                        <th>Prepared By</th>
                                        <th>Status</th>
                                       
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="req in cheques">
                                        <td class="hidden-xs">{{$index + 1}}</td>
                                        <td>{{req.chequeNo}}</td>
                                        <td>{{req.Transporter}}</td>
                                        <td>{{req.Amount | number:2}}</td>
                                        <td >{{req.BankName}}</td>
                                        <td>{{req.PreparedBy}}</td>
                                        <td>{{req.Status}}</td>
                                        @*<td ng-switch on="req.State">
                                        <div ng-switch-when=1>Draft</div>  
                                        <div ng-switch-when=2>Approved</div>
                                        <div ng-switch-when=3>Cashed</div>*@
                                        
                                      @*  </td>*@
                                         
                                        @* <th> <a style="display: block;" ng-click="ShowURl(req)" > <button class="btn btn-sm btn-default">{{req.ButtonStatus}} </button></a></></th>*@
                                        @*<th> <a style="display: block;" ng-click="ShowURl(req)" ><button class="btn btn-sm btn-default"> {{req.Status}} </button> </a></th>*@
                                            
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

      <div class="container">

        <div>
            <div class="row" style="border-bottom-width: thin; border-bottom-color: #666; border-bottom-style: inset; margin-top: 5px">

                <div class="pull-left">
                    <h4>Payment Requests being Processed at Logistics Case Team </h4>
                </div>
                <div class="pull-right">
                    <div class="btn-group">
                        <button id="paymentRequestBeingProcessedHeader" type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-arrow-up"></i>
                            <i class="icon-arrow-down"></i>
                        </button>

                    </div>
                </div>
            </div>
            <div id="paymentRequestContent" class="row">
                <div>&nbsp;</div>
                <div ng-controller="paymentRequestController" class="span11">
                    <div class="portlet">
                        <div class="portlet-header">
                            <h3>

                                <i class=""></i>
                                Payment Status
                            </h3>
                            @*<ul class="portlet-tools pull-right">
                                <li>
                                    
                                        <a href="@Url.Action("Index","ValidatedPaymentRequest",new {Area ="Finance"})">Detail</a>   
                                   

                                </li>
                            </ul>*@
                        </div>

                        <!-- /.portlet-header -->

                        <div class="portlet-content">
                            <th class="table-responsive">
                            <table id="" class="table table-striped table-checkable">
                                <thead>
                                    <th class="portlet-header" colspan="7">Payment Request</th>
                                    @*<th class="portlet-header" colspan="3">Reference</th>*@
                                    <tr>
                                            
                                        <th class="hidden-xs">Number</th>
                                        <th>Transporter Name</th>
                                        <th style="text-align: center">Requested Amount</th>
                                        <th style="text-align: center">Aditional Labour Cost</th>
                                        <th style="text-align: center">Total Amount</th>
                                        <th style="text-align: center">Rejected Amount</th>
                                        <th style="text-align: center">Net Pay</th>
                                        
                                        @*<th>Date</th>
                                        <th>Check No</th>
                                        <th>PV No</th>*@
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="req in paymentRequestBeingProcessed">
                                        <td class="hidden-xs">{{$index + 1}}</td>
                                        <td>@* <a ng-href="@Url.Content("~/Finance/ValidatedPaymentRequest/PaymentRequests/{{req.TransporterId}}")">*@ {{req.Transporter}}</td>
                                        <td style="text-align: center; margin-right: 20px">{{req.RequestedAmount}}</td>
                                        <td style="text-align: center; margin-right: 20px">{{req.AditionalLabourCost | number:2}}</td>
                                        <td style="text-align: center; margin-right: 20px">{{req.RequestedAmount + req.AditionalLabourCost | number:2}} </td>
                                        <td style="text-align: center; margin-right: 20px">{{req.RejectedAmount | number:2}}</td>
                                        <td style="text-align: center; margin-right: 20px">{{(req.RequestedAmount + req.AditionalLabourCost) - req.RejectedAmount | number:2}} </td>
                                        @*<td style="text-align: right; margin-right: 20px">{{req.Date}}</td>
                                        <th>{{req.ChequeNo}}</th>
                                        <th>{{req.PVNo}}</th>*@
                                        
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>


<script>

    myApp = angular.module('myApp', []);

    myApp.controller('paymentRequestController', ['$scope', '$http', '$rootScope', function ($scope, $http) {


        $scope.paymentRequestForDashboard = {};
        $scope.paymentRequestBeingProcessed = {};
        $http({ method: 'GET', url: '@Url.Action("PaymentRequestForDashboard", "Home")' }).success(function (data, status, headers, config) {
            console.log(data);
            $scope.paymentRequestForDashboard = data;
            $scope.viewPaymentDetail = function (item) {
                // alert("Show Detail");
                var id = item.TransporterId;
                window.open("@Url.Action("PaymentRequests","ValidatedPaymentRequest")" + "?transporterID=" + id, "_blank");
              };
        });
        $http({ method: 'GET', url: '@Url.Action("PaymentRequestBeingProcessed", "Home")' }).success(function (data, status, headers, config) {
            console.log(data);
            $scope.paymentRequestBeingProcessed = data;
           
         });
    }]);

    myApp.controller('ChequeController', ['$scope', '$http', '$rootScope', function ($scope, $http) {


        $scope.cheques = {};
        $http({ method: 'GET', url: '@Url.Action("ReadCheques", "Home")' }).success(function (data, status, headers, config) {
            $scope.cheques = data;
            console.log(data);
        });
        
        $scope.ShowURl = function (url) {
            var state = url.State;
            window.location = "@Url.Action("UpdateChequeStatus", "Home")" + "?transporterChequeId=" + url.transporterChequeId + "&status=" + (state + 1);
        };

    }]);
    
</script>
