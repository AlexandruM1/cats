@using Kendo.Mvc.UI
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}
@section Toolbar
{
    <a data-buttontype="btn_new_record"  id="btnAddDonationPlan" class="btn toolbar-btn " href="@Url.Action("AddNewDonationPlan", "Donation")"></a>
}
<fieldset>
    
        <legend>
            Donation Plan
        </legend>
    
</fieldset>

@(Html.Kendo().Grid<Cats.Areas.Logistics.Models.ReceiptAllocationViewModel>()
    .Name("grid")
    .Columns(columns =>
    {
        columns.Bound(p => p.CommodityName).Title("Commodity").Width(100);
        columns.Bound(p => p.Hub).Title("Hub").Width(100);
        columns.Bound(p => p.SINumber).Width(100);
        columns.Bound(p => p.AllocatedQuantity).Title("Allocated").Width(100);
        columns.Bound(p => p.ReceivedQuantity).Title("Received").Width(100);
        columns.Bound(p => p.Balance).Title("Balance").Width(100);

        //columns.Command(command =>
        //                    {
        //                        command.Edit();
        //                        command.Destroy();
        //                    }).Width(160);
    })
    
    .Editable(editable => editable.Mode(GridEditMode.InCell))
    .Pageable()
    .Sortable()
    .Scrollable()
    .HtmlAttributes(new { style = "height:430px;" })
    .DataSource(dataSource => dataSource
        .Ajax()
        .PageSize(20)
        .Events(events => events.Error("error_handler"))
        .Model(model => model.Id(p => p.ReceiptAllocationID))
        .Create(update => update.Action("EditingInline_Create", "Grid"))
        .Read(read => read.Action("ReadReceiptAllocation", "Donation"))
        .Update(update => update.Action("EditingInline_Update", "Grid"))
        .Destroy(update => update.Action("EditingInline_Destroy", "Grid"))
    )
)
<script type="text/javascript">
    function error_handler(e) {
        if (e.errors) {
            var message = "Errors:\n";
            $.each(e.errors, function (key, value) {
                if ('errors' in value) {
                    $.each(value.errors, function () {
                        message += this + "\n";
                    });
                }
            });
            alert(message);
        }
    }
</script>

<script type="text/javascript">
    $(function () {

        //Optional: turn the chache off
        $.ajaxSetup({ cache: false });

       

        $('#btnAddDonationPlan').click(function () {

            // alert("");
            $('#dialogContent').load(this.href, function () {
                $('#dialogDiv').modal({
                    backdrop: 'static',
                    keyboard: true
                }, 'show');
                //bindForm(this);
            });
            return false;
        });
    });
</script>

<div id='dialogDiv' class='modal hide fade in'>
    <div id='dialogContent'></div>
</div>