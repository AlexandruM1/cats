@*@using Cats.Helpers

@{
    ViewBag.Title = "Index";
    ViewBag.ViewWidth = "Wide";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<link href="~/Content/DashboardWidget.css" rel="stylesheet">

<html>
<body>
    <div class="row">
        <div class="span6">
            <div class="widget stacked">
                <div class="widget-header">
                    <i class="icon-bookmark"></i>
                    <h3>Welcome to Logistics</h3>
                </div>
                <div class="widget-content">

                    <div class="shortcuts">
                        <a href="@Url.Action("Index", "BeneficiariesAllocation", new { Area = "Logistics" })" class="shortcut"><i class="shortcut-icon icon-list-alt"></i>
                            <span class="shortcut-label">Beneficiaries Allocation</span>
                        </a>

                        <a href="@Url.Action("Index", "HubAllocation", new { Area = "Logistics" })" class="shortcut"><i class="shortcut-icon icon-signal"></i>
                            <span class="shortcut-label">Hub Allocation</span>
                        </a>

                        <a href="@Url.Action("Index", "ProjectAllocation", new { Area = "Logistics" })" class="shortcut"><i class="shortcut-icon icon-inbox"></i>
                            <span class="shortcut-label">Project Allocation</span>
                        </a>

                        <a href="@Url.Action("Index", "TransportRequisition", new { Area = "Logistics" })" class="shortcut"><i class="shortcut-icon icon-tasks"></i>
                            <span class="shortcut-label">Transport Requisition</span>
                        </a>

                    </div>

                </div>
            </div>
        </div>

        <div class="span6">
            <div class="widget stacked">
                <div class="widget-header">
                    <i class="icon-bookmark"></i>
                    <h3>Active Requisitions from Regions</h3>
                </div>
                <div class="widget-content">
                    @Html.Partial("_ApprovedRequisitions")
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="span6">
            <div class="widget stacked">
                <div class="widget-header">
                    <i class="icon-bookmark"></i>
                    <h3>Transport Contract Execution</h3>
                </div>
                <div class="widget-content">
                    @Html.Partial("_TransportContractsExecution")
                </div>
            </div>
        </div>
    </div>
    @Html.Partial("_DispatchProgress")

</body>
</html>*@

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
    const string PAGE_NAME = "Logistics.Index";
}

@section styles
{
   
    <link href="~/Content/Dashboard/dashboardcomponents.css" rel="stylesheet" />
   }
<div ng-app="myApp">
    <div class="container">
        <div ng-controller="Regions" class="container row">
            
            <div class="span12" > <h4>Region:</h4> 
                <select ng-change="onChange(regionName)"   ng-model="regionName" ng-options="r.name as r.name for r in regions" >
                    <option > Choose a Region </option>
                </select>
                 <pre>Region: {{regionName}}</pre>   
            </div>
            <hr />
        </div>
    </div>
    <div class="container">
       
        <hr />

        <div ng-controller="ImportantNumbers" class="container row">
            
           
            <div class="span11">
                <a href="javascript:;" class="dashboard-stat">
                    <div class="visual">
                        @*<i class="icon-star"></i>*@
                    </div>
                    <!-- /.visual -->

                    <div class="details column-divider-regional center">
                        <span class="content">Approved Requests</span>
                        <span class="value">{{totalApproved }}</span>
                    </div>

                    <div class="details column-divider-regional center">
                        <span class="content">Hub Assigned</span>
                        <span class="value">{{pendingHubAloocation}}</span>
                    </div>

                    <div class="details column-divider-regional center">
                        <span class="content">SI/PC Assigned</span>
                        <span class="value">{{pendingSIPCAllocation}} </span>
                    </div>

                    <div class="details column-divider-regional center">
                        <span class="content">transport Requisition(s)</span>
                        <span class="value">{{pendingTransportOrder}} </span>
                    </div>

                    <!-- /.details -->
                    
                </a>
                <!-- /.dashboard-stat -->
            </div>
            <!-- /.col-md-3 -->

           @* <div class="span2">

                <a href="javascript:;" class="dashboard-stat">
                    <div class="visual">
                      
                    </div>
                   

                    <div class="details">
                        <span class="content">Total Plans</span>
                        <span class="value">8</span>
                    </div>
                    

                </a>
               

            </div>*@
          

           @* <div class="span2">

                <a href="javascript:;" class="dashboard-stat">
                    <div class="visual">
                       
                    </div>
                

                    <div class="details">
                        <span class="content">Receipt Plan</span>
                        <span class="value">5</span>
                    </div>
                   

                    

                </a>
               

            </div>*@
           
        </div>
        <hr />
    </div>

    <div class="container">

        <div>
            <div class="row" style="border-bottom-width: thin; border-bottom-color: #666; border-bottom-style: inset; margin-top: 5px">

                <div class="pull-left">
                    <h4>Approved Requests</h4>
                </div>
                <div class="pull-right">
                    <div class="btn-group">
                        <button id ="ApprovedRequestHeader"type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-arrow-up"></i> 
                            <i class="icon-arrow-down"></i> 
                        </button>

                    </div>
                </div>
            </div>
            <div id="ApprovedRequestContent"class="row">
                <div>&nbsp;</div>
                <div ng-controller="ApprovedRequestsController" class="span8">
                    <div class="portlet">
                        <div class="portlet-header">
                            <h3>
                              
                                <i class=""></i>
                                Approved Requests
                            </h3>
                            <ul class="portlet-tools pull-right">
                                <li>
                                    <button class="btn btn-sm btn-default">
                                        Detail
                                    </button>
                                   
                                </li>
                            </ul>
                        </div>

                        <!-- /.portlet-header -->

                        <div class="portlet-content">
                            <th class="table-responsive">
                            <table id="" class="table table-striped table-checkable">
                                <thead>
                                    <tr>
                                        <th class="hidden-xs">Number</th>
                                        <th>Req No</th>
                                        <th>Zone</th>
                                        <th>Beneficiaries</th>
                                        <th>Amount(mt)</th>
                                        <th>Commodity</th>
                                          
                                        <th class="align-center">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="req in requests.request  | filter:{RegionName:regionName}">
                                        <td class="hidden-xs">{{$index + 1}}</td>
                                        <td>{{req.reqNo}}</td>
                                        <td>{{req.zone}}</td>
                                        <th>{{req.beneficiaries | number}}</th>
                                        <th>{{req.amount | number}}</th>
                                        <th>{{req.commodity}}</th>
                                       
                                       
                                        <td><span class="label label-danger">Pending</span></td>
                                        <td class="align-center">
                                            @*<a class="btn btn-sm btn-default" data-original-title="Approve" href="@Url.Action("AssignHubFromLogisticsDashboard", "DispatchAllocation", new { Area = "Logistics", paramRegionId =  )"> Assign Hub </a>*@
                                        </td>
                                           
                                    </tr>
                                    
                                </tbody>
                            </table>

                        </div>
                        
                    </div>  <!-- /.portlet-content -->

                </div>
                @*<div class="span3">

                    <div class="portlet">
                        <div class="portlet-header">
                            <h3>
                                <i class=""></i>
                                Percentage
                            </h3>
                        </div>

                       

                        <div class="portlet-content">
                            <div class="progress-stat">

                                <div class="stat-header">

                                    <div class="pull-left">
                                        Approved Requests
                                    </div>
                                  
                                    <div class="pull-right">
                                        33%
                                    </div>
                                   

                                </div>
                              

                               
                                <div class="progress progress-success">
                                    <div class="bar" style="width: 33%"></div>
                                </div>
                               

                            </div>
                         

                            <div class="progress-stat">

                                <div class="stat-header">

                                    <div class="pull-left">
                                        Pending Requests
                                    </div>
                                   

                                    <div class="pull-right">
                                        42%
                                    </div>
                                   

                                </div>
                               

                                <div class="progress progress-danger">
                                    <div class="bar" style="width: 42%"></div>
                                </div>
                               

                            </div>
                           

                            <div class="progress-stat">

                                <div class="stat-header">

                                    <div class="pull-left">
                                        Allocated
                                    </div>
                                   

                                    <div class="pull-right">
                                        25%
                                    </div>
                                  

                                </div>
                              

                                <div class="progress progress-warning">
                                    <div class="bar" style="width: 25%"></div>
                                </div>
                               

                            </div>
                          

                            <br>
                        </div>
                       

                    </div>
                  
                </div>*@
               
            </div>
        </div>

        
        
        
        
        <div>
            <div class="row" style="border-bottom-width: thin; border-bottom-color: #666; border-bottom-style: inset; margin-top: 5px">

                <div class="pull-left">
                    <h4>Current HRD</h4>
                </div>
                <div class="pull-right">
                    <div class="btn-group">
                        <button id="CurrentHRDHeader"type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-arrow-up"></i> 
                            <i class="icon-arrow-down"></i> 
                        </button>

                    </div>
                </div>
            </div>
            <div id="CurrentHRDContent" class="row">
                <div>&nbsp;</div>

                <div ng-controller="CurrentHRDController" class="span8">
                    <div class="portlet">
                        <div class="portlet-header">
                            <h3>
                                <i class=""></i>
                                Current HRD
                            </h3>
                            
                        </div>

                        <!-- /.portlet-header -->

                        <div class="portlet-content">
                            <th class="table-responsive">
                            <table id="" class="table table-striped table-checkable">
                                <thead>
                                    <tr>
                                        <th class="hidden-xs">Number</th>
                                        <th>Plan</th>
                                        <th>Season</th>
                                        <th>Year</th>
                                        <th>Ration</th>
                                        <th>Created By</th>
                                        <th>Created Date</th>
                                        <th>PublishedDate</th>

                                        
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="req in currentHRD">
                                        <td class="hidden-xs">{{$index + 1}}</td>
                                        <td>{{req.Plan}}</td>
                                        <td>{{req.Season}}</td>
                                        <td>{{req.Year}}</td>
                                        <td>{{req.Ration}}</td>
                                        <td>{{req.CreatedBy}}</td>
                                        <th>{{req.CreatedDatePref}}</th>
                                        <th>{{req.PublishedDatePref}}</th>
                                      
                                       
                                    </tr>

                                </tbody>
                            </table>

                        </div>
                        <!-- /.table-responsive -->
                    </div>
                    <!-- /.portlet-content -->

                </div>

                <!-- /.portlet -->
            </div>
        </div>
        
        
        <div>
            <div class="row" style="border-bottom-width: thin; border-bottom-color: #666; border-bottom-style: inset; margin-top: 5px">

                <div class="pull-left">
                    <h4>Bid</h4>
                </div>
                <div class="pull-right">
                    <div class="btn-group">
                        <button id="BidWinnersHeader"type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-arrow-up"></i> 
                            <i class="icon-arrow-down"></i> 
                        </button>

                    </div>
                </div>
            </div>
            <div id="BidWinnerContent" class="row">
                <div>&nbsp;</div>

                <div ng-controller="BidWinnersController" class="span8">
                    <div class="portlet">
                        <div class="portlet-header">
                            <h3>
                                <i class=""></i>
                                Bid Winners
                            </h3>
                            
                        </div>

                        <!-- /.portlet-header -->

                        <div class="portlet-content">
                            <th class="table-responsive">
                            <table id="" class="table table-striped table-checkable">
                                <thead>
                                    <tr>
                                       
            
                                             Bid:
                                                <select ng-change="onChange(bid)"   ng-model="bid" ng-options="bid.BidNo as bid.BidNo for bid in bids" >
                                                    <option > Choose a Bid </option>
                                                </select>
                                                <pre>Bid: {{bid}}</pre>   
                                            
                                           
                                       
                                    </tr>
                                    <tr>
                                        <th class="hidden-xs">Number</th>
                                        <th>Transporter Name</th>
                                        <th>Capital</th>
                                        <th>Sub City</th>
                                        <th>Mobile No</th>
                                         <th>FDP</th>
                                        <th>Zone</th>
                                        <th>Region</th>
                                        
                                        
                                       
                                        
                                        
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="req in bidWinners.bid | filter:{RegioName:regionName}">
                                        <td class="hidden-xs">{{$index + 1}}</td>
                                        <td>{{req.Name}}</td>
                                        <td>{{req.Capital}}</td>
                                        <td>{{req.SubCity}}</td>
                                         <th>{{req.MobileNo}}</th>
                                         <th>{{req.Fdp}}</th>
                                        <th>{{req.ZoneName}}</th>
                                        <th>{{req.RegioName}}</th>
                                       
                                        
                                       
                                     </tr>

                                </tbody>
                            </table>

                        </div>
                        <!-- /.table-responsive -->
                    </div>
                    <!-- /.portlet-content -->

                </div>

                <!-- /.portlet -->
            </div>
        </div>
        

        <div>
            <div class="row" style="border-bottom-width: thin; border-bottom-color: #666; border-bottom-style: inset; margin-top: 5px">

                <div class="pull-left">
                    <h4>SI Allocation</h4>
                </div>
                <div class="pull-right">
                    <div class="btn-group">
                        <button id="SIPCHeader" type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-arrow-up"></i> 
                            <i class="icon-arrow-down"></i> 
                        </button>

                    </div>
                </div>
            </div>
            <div id="SIPCContent"class="row">
                <div>&nbsp;</div>

                <div ng-controller="SIPCController" class="span8">
                    <div class="portlet">
                        <div class="portlet-header">
                            <h3>
                                <i class=""></i>
                                Requistions to be SI Allocated
                            </h3>
                            <ul class="portlet-tools pull-right">
                                <li>
                                    <button class="btn btn-sm btn-default">
                                        Show more
                                    </button>
                                    @*<a class="btn btn-sm btn-default" href="@Url.Action("Index", "DeliveryReconcile", new { Area="Logistics", regionID= ViewBag.RegionID })">FDP Commodity Receipt</a>*@
                                </li>
                            </ul>
                        </div>

                        <!-- /.portlet-header -->

                        <div class="portlet-content">
                            <th class="table-responsive">
                            <table id="" class="table table-striped table-checkable">
                                <thead>
                                    <tr>
                                        <th class="hidden-xs">Number</th>
                                        <th>Req No</th>
                                        <th>Program</th>
                                        <th>Zone</th>
                                        <th>Beneficiaries</th>
                                        <th>Amount</th>
                                        <th>Commodity</th>
                                        <th>Allocation Type</th>
                                        
                                    </tr>
                                </thead>
                                <tbody>
                                   <tr ng-repeat="req in requestsSIPCAllocated.request |  filter:{RegionName:regionName}">
                                        <td class="hidden-xs">{{$index + 1}}</td>
                                       <td>{{req.reqNo}}</td>
                                       <td>{{req.program}}</td>
                                        <td>{{req.zone}}</td>
                                        <th>{{req.beneficiaries | number}}</th>
                                        <th>{{req.amount | number}}</th>
                                       <th>{{req.commodity}}</th>
                                        <th>{{req.allocationType}}</th>
                                   
                                   
                                  
                                            <td><span class="label label-danger">Pending</span></td>
                                            @*<td class="align-center">
                                                <a class="btn btn-sm btn-default" data-original-title="Approve">Create Transport Requisition</a>
                                            </td>*@
                                </tr>


                                </tbody>
                            </table>

                        </div>
                        <!-- /.table-responsive -->
                    </div>
                    <!-- /.portlet-content -->

                </div>
                <div class="span3">

                    <div class="portlet">
                        <!-- /.portlet-header -->

                        <div class="">
                            <a href="javascript:;" class="dashboard-stat">
                                <div class="details ">
                                    <span class="content">Number of Incoming Dispatches</span>
                                    <span class="value">98 </span>
                                </div>
                            </a>
                            <br>
                        </div>

                        <div class="">
                            <a href="javascript:;" class="dashboard-stat">
                                <div class="details ">
                                    <span class="content">Total Incoming Commodity</span>
                                    <span class="value">200 QT </span>
                                </div>
                            </a>
                            <br>
                        </div>
                        <!-- /.portlet-content -->

                    </div>
                    <!-- /.portlet -->
                </div>
                <!-- /.portlet -->
            </div>
        </div>

        <div>
            <div class="row" style="border-bottom-width: thin; border-bottom-color: #666; border-bottom-style: inset; margin-top: 5px">

                <div class="pull-left">
                    <h4>Transport Requisition</h4>
                </div>
                <div class="pull-right">
                    <div class="btn-group">
                        <button id="TransportRequisitionHeader"type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
                            <i class="icon-arrow-up"></i> 
                            <i class="icon-arrow-down"></i> 
                        </button>

                    </div>
                </div>
            </div>
            <div id="TransportRequisitionContent"class="row">
                <div>&nbsp;</div>

                <div ng-controller="TransportRequisitionController" class="span8">
                    <div class="portlet">
                        <div class="portlet-header">
                            <h3>
                                <i class=""></i>
                                Current Transport Requisition
                            </h3>
                            <ul class=" pull-right portlet-tools ">
                                <li>
                                    <button class="btn btn-sm btn-default">
                                        Show more
                                    </button>

                                </li>
                            </ul>
                        </div>

                        <!-- /.portlet-header -->

                        <div class="portlet-content">
                            <th class="table-responsive">
                            <table id="" class="table table-striped table-checkable">
                                <thead>
                                    <tr>
                                        <th class="hidden-xs">Number</th>
                                        
                                        <th>Req No</th>
                                        <th>Zone</th>
                                        <th>Beneficiaries</th>
                                        <th>Amount</th>
                                        <th>Commodity</th>
                                            
                                    </tr>
                                </thead>
                                <tbody>
                                     <tr ng-repeat="req in TransportRequestion.request | filter:{RegionName:regionName}">
                                        <td class="hidden-xs">{{$index + 1}}</td>
                                        <td>{{req.reqNo}}</td>
                                        <td>{{req.zone}}</td>
                                        <th>{{req.beneficiaries}}</th>
                                        <th>{{req.amount}}</th>
                                        <th>{{req.commodity}}</th>
                                       
                                    
                                        <td><span class="label label-default">On process</span></td>
                                        <td>
                                            <a href="javascript:;" class="btn btn-sm btn-default">View <i class="icon-chevron-right"></i>
                                            </a>
                                        </td>
                                    </tr>
                                    </tbody>
                            </table>

                        </div>
                        <!-- /.table-responsive -->
                    </div>
                    <!-- /.portlet-content -->

                </div>
                
                
                <!-- /.portlet -->
            </div>
        </div>

    </div>
</div>

<script>
    $("#ApprovedRequestHeader").click(function () {
        $("#ApprovedRequestContent").slideToggle("slow", "linear");
    });
    
    $("#CurrentHRDHeader").click(function () {
        $("#CurrentHRDContent").slideToggle("slow", "linear");
    });
    
    $("#SIPCHeader").click(function () {
        $("#SIPCContent").slideToggle("slow", "linear");
    });
    
    $("#TransportRequisitionHeader").click(function () {
        $("#TransportRequisitionContent").slideToggle("slow", "linear");
    });
</script>

<script>
    

    var myApp = angular.module('myApp', []);
    
    myApp.controller('ImportantNumbers', ['$scope', '$http','$rootScope', function ($scope, $http, $rootScope) {

        $rootScope.totalRequisitions = 0;
        $rootScope.totalApproved = 0;
        $rootScope.pendingHubAloocation = 0;
        $rootScope.pendingSIPCAllocation = 0;
        $rootScope.pendingTransportOrder = 0;
        
       
    }]);



    myApp.controller('CurrentHRDController', ['$scope', '$http', '$rootScope', function ($scope, $http, $rootScope) {

        $scope.qty = 6;
        $scope.currentHRD = {};
        $http({ method: 'GET', url: '@Url.Action("CurrentHrdRead","Home")' }).success(function (data, status, headers, config) {
            $.each(data, function (i, item) {
              
                $scope.currentHRD[i] = item;
            });
            
        });
        $rootScope.regionName = "";
    }]);
    
    myApp.controller('BidWinnersController', ['$scope', '$http', '$rootScope', function ($scope, $http, $rootScope) {

       
        $scope.bidWinners = {};
        $rootScope.regionName = "";
        
        $scope.bids = [];
        $http({ method: 'GET', url: '@Url.Action("GetBids","Home")' }).success(function (data, status, headers, config) { $scope.bids = data;
             });



        $scope.onChange = function (bidId) {
           
            $http({ method: 'GET', params: { id: bidId }, url: '@Url.Action("GetListOfBidWinners","Home")' }).success(function (data, status, headers, config) {$scope.bidWinners.bid = data;});
        };
        
     }]);

 

    myApp.controller('ApprovedRequestsController', ['$scope', '$http', '$rootScope', function ($scope, $http, $rootScope) {

        $scope.qty = 6;
        $scope.requests = { };
        $http({ method: 'GET', url: '@Url.Action("GetRequiasitions","Home", new {id = 2})' }).success(function (data, status, headers, config) { $scope.requests.request = data; console.log($scope.requests.request); });
        $rootScope.regionName = "";
    }]);
    
    myApp.controller('HubAllocationController', ['$scope', '$http','$rootScope', function ($scope, $http, $rootScope) {
        $scope.qty = 6;
        $scope.requestsApproved = {};
        $http({method: 'GET',url: '@Url.Action("GetRequiasitions","Home", new {id = 3})'}).success(function (data, status, headers, config) {$scope.requestsApproved.request = data;})
        $rootScope.regionName = "";
    }]);
    myApp.controller('SIPCController', ['$scope', '$http', '$rootScope', function ($scope, $http, $rootScope) {
        
        $scope.qty = 6;
        $scope.requestsSIPCAllocated = {};
        $http({ method: 'GET', url: '@Url.Action("GetSiPcAllocation","Home")' }).success(function (data, status, headers, config) { $scope.requestsSIPCAllocated.request = data;
            console.log(data);})
        .error(function (data, status, headers, config) {
           });
        

        $rootScope.regionName = "";
    }]);
    
    myApp.controller('TransportRequisitionController', ['$scope', '$http', '$rootScope', function ($scope, $http, $rootScope) {
        
        $scope.qty = 6;
        $scope.TransportRequestion = {};
        $http({method: 'GET',url: '@Url.Action("GetRequiasitions","Home", new {id = 5})'}).success(function (data, status, headers, config) {$scope.TransportRequestion.request = data;})
        .error(function (data, status, headers, config) {
           
        });

        $rootScope.regionName = "";
    }]);
    

    myApp.controller('Regions', ['$scope', '$http', '$rootScope', function ($scope, $http, $rootScope) {

        $scope.regions = [];
        $http({method: 'GET',url: '@Url.Action("GetRegions","Home")'}).success(function (data, status, headers, config) {$scope.regions = data;})
        .error(function (data, status, headers, config) {
           
        });
        

        $scope.onChange = function (name) {
            $rootScope.regionName = name;
            
            $http({ method: 'GET', params: { id: name }, url: '@Url.Action("ImportantNumbers","Home")' }).success(function (data, status, headers, config) {

                $rootScope.totalRequisitions = 0;
                $rootScope.totalApproved = 0;
                $rootScope.pendingHubAloocation = 0;
                $rootScope.pendingSIPCAllocation = 0;
                $rootScope.pendingTransportOrder = 0;
            $.each(data, function (i, item) {
              
                switch (item.Status) {
                    case 1:
                        $rootScope.totalRequisitions = item.Count;
                        break;
                    case 2:
                        $rootScope.totalApproved = item.Count;
                        break;
                    case 3:
                        $rootScope.pendingHubAloocation = item.Count;
                        break;
                    case 4:
                        $rootScope.pendingSIPCAllocation = item.Count;
                        break;
                    case 5:
                        $rootScope.pendingTransportOrder = item.Count;
                        break;
                    case 6:
                        break;
                    default:
                }

            });



        })
        .error(function (data, status, headers, config) {
           
        });          
        };

    }]);
    
    
</script>

